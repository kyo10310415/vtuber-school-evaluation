# WEB UI修正ガイド

## 📊 修正内容

### 1️⃣ プロレベル評価の表示修正

**問題**: 評価詳細画面でプロレベル評価が表示されない

**原因**: APIから正しくデータが返されているが、フロントエンドの表示が最適化されていなかった

**修正内容**:
- 項目名を短縮（「アクティブリスニング」→「傾聴力」）
- グリッドレイアウトを調整（gap-4 → gap-3）
- テキストサイズを調整（text-3xl → text-2xl）

**修正後の表示**:
```
┌─────────────────────────┬──────────────────────┐
│   総合評価: A           │ 欠席: S  遅刻: S    │
│                         │ ミッション: S 支払い: C │
│                         │ 傾聴力: A  理解度: S │
└─────────────────────────┴──────────────────────┘
```

---

### 2️⃣ YouTube評価の週間配信回数の計算方法修正

**問題**: 週間配信回数が実際の数と異なる

**修正前の計算方法**:
```javascript
const weeklyStreamCount = videosInMonth / 4; // 月を4週間と仮定
```

この方法では、31日の月も28日の月も同じ「4週間」として計算されるため、不正確でした。

**修正後の計算方法**:
```javascript
// 月の実際の週数を計算
const [year, month] = targetMonth.split('-').map(Number);
const firstDay = new Date(year, month - 1, 1);
const lastDay = new Date(year, month, 0);
const daysInMonth = lastDay.getDate();
const actualWeeks = daysInMonth / 7; // 実際の週数

const weeklyStreamCount = videosInMonth / actualWeeks;
```

**例**:
- 2025年12月（31日）: actualWeeks = 31/7 ≈ 4.43週
- 月間32本配信 → 週間配信回数 = 32 / 4.43 ≈ 7.2回
- 修正前: 32 / 4 = 8.0回（不正確）

**平均配信時間の計算方法**:
```javascript
// 各動画の時間を分単位で取得
const durations = monthVideos.map((v) => parseDuration(v.duration));

// 平均を計算
const averageStreamDuration = durations.length > 0
  ? durations.reduce((sum, d) => sum + d, 0) / durations.length
  : 0;
```

ISO 8601形式（PT1H30M15S）を分単位に変換して平均を計算します。

---

### 3️⃣ YouTube/X評価基準の明確化

## YouTube評価基準（合計100点 → S～D）

| 項目 | 配点 | 評価基準 |
|------|------|----------|
| **週4回配信目標** | 20点 | ✅ 週4回以上: 20点<br>週3回以上: 15点<br>週2回以上: 10点<br>週1回以上: 5点 |
| **1.5時間配信目標** | 20点 | ✅ 90分以上: 20点<br>60分以上: 15点<br>30分以上: 10点<br>0分超: 5点 |
| **登録者伸び率** | 20点 | 10%以上: 20点<br>5%以上: 15点<br>2%以上: 10点<br>0%超: 5点 |
| **エンゲージメント率** | 20点 | 5%以上: 20点<br>3%以上: 15点<br>1%以上: 10点<br>0%超: 5点 |
| **タイトル・サムネ品質** | 20点 | Excellent: 20点<br>Good: 15点<br>Average: 10点<br>Poor: 5点 |

**5段階評価**:
- **S**: 90点以上（90%以上）
- **A**: 80～89点（80～89%）
- **B**: 70～79点（70～79%）
- **C**: 60～69点（60～69%）
- **D**: 60点未満（60%未満）

**エンゲージメント率の計算**:
```
エンゲージメント率 = (総いいね数 + 総コメント数) / 総視聴回数 × 100
```

---

## X評価基準（合計100点 → S～D）

| 項目 | 配点 | 評価基準 |
|------|------|----------|
| **1日2回投稿目標** | 20点 | ✅ 2回以上: 20点<br>1.5回以上: 15点<br>1回以上: 10点<br>0回超: 5点 |
| **週2回企画投稿目標** | 20点 | ✅ 2回以上: 20点<br>1.5回以上: 15点<br>1回以上: 10点<br>0回超: 5点 |
| **フォロワー伸び率** | 20点 | 10%以上: 20点<br>5%以上: 15点<br>2%以上: 10点<br>0%超: 5点 |
| **エンゲージメント率** | 20点 | 10%以上: 20点<br>7%以上: 15点<br>5%以上: 10点<br>0%超: 5点 |
| **インプレッション伸び率** | 20点 | 20%以上: 20点<br>10%以上: 15点<br>5%以上: 10点<br>0%超: 5点 |

**5段階評価**:
- **S**: 90点以上（90%以上）
- **A**: 80～89点（80～89%）
- **B**: 70～79点（70～79%）
- **C**: 60～69点（60～69%）
- **D**: 60点未満（60%未満）

**エンゲージメント率の計算**:
```
エンゲージメント率 = (いいね + リツイート + リプライ) / インプレッション × 100
```

---

## 🧮 評価例

### YouTube評価例（石山光司さん・2025-12）

**実績**:
- 登録者数: 875人（伸び率: 0%）
- 月間配信数: 32本
- 週間配信回数: 7.2回（32本 ÷ 4.43週）
- 平均配信時間: 236分（3.9時間）
- エンゲージメント率: 3.33%
- タイトル品質: Good
- サムネイル品質: Good

**採点**:
1. 週4回配信目標: 20点（✅ 週7.2回）
2. 1.5時間配信目標: 20点（✅ 236分）
3. 登録者伸び率: 0点（0%）
4. エンゲージメント率: 15点（3.33%）
5. タイトル・サムネ品質: 15点（Good）

**合計**: 70点 / 100点 = 70% → **B評価**

---

### X評価例（石山光司さん・2025-12）

**実績**:
- フォロワー数: 2,638人（伸び率: 0%）
- 月間投稿数: 100件
- 日次投稿平均: 3.2回
- 週次企画投稿: 1.25回
- エンゲージメント率: 8.24%
- インプレッション伸び率: 0%

**採点**:
1. 1日2回投稿目標: 20点（✅ 3.2回）
2. 週2回企画投稿目標: 10点（1.25回）
3. フォロワー伸び率: 0点（0%）
4. エンゲージメント率: 20点（✅ 8.24%）
5. インプレッション伸び率: 0点（0%）

**合計**: 50点 / 100点 = 50% → **D評価**

---

## 📝 評価基準の設計思想

### YouTube評価の重点
1. **配信頻度**: 週4回の定期配信（ファン定着）
2. **配信時間**: 1.5時間以上の長時間配信（視聴者エンゲージメント）
3. **成長率**: 登録者数の伸び（チャンネルの成長）
4. **エンゲージメント**: いいね・コメント（視聴者の反応）
5. **品質**: タイトル・サムネイルの完成度（クリック率向上）

### X評価の重点
1. **投稿頻度**: 1日2回の定期投稿（タイムライン露出）
2. **企画投稿**: 週2回の企画投稿（ブランディング）
3. **成長率**: フォロワー数の伸び（影響力拡大）
4. **エンゲージメント**: いいね・リツイート・リプライ（反応率）
5. **インプレッション**: 表示回数の伸び（リーチ拡大）

---

## 🔧 適用手順

### ステップ1: 修正版ファイルをデプロイ

1. GitHubから最新版をプル
2. ビルド＆デプロイ

```bash
cd /home/user/webapp
git pull origin main
cp -r public/static/* dist/static/
pm2 restart webapp
```

### ステップ2: 動作確認

1. 評価詳細ページを開く
   - https://vtuber-school-evaluation.onrender.com/evaluation-detail?studentId=OLTS240488-AR&month=2025-12

2. プロレベル評価が表示されるか確認

3. YouTube評価の週間配信回数を確認

---

## 📊 データ取得APIエンドポイント

### 統合評価API
```
GET /api/evaluation/complete/:studentId?month=YYYY-MM
```

**レスポンス例**:
```json
{
  "success": true,
  "studentId": "OLTS240488-AR",
  "studentName": "石山光司",
  "month": "2025-12",
  "proLevel": {
    "総合評価": "A",
    "欠席": "S",
    "遅刻": "S",
    "ミッション": "S",
    "支払い": "C",
    "アクティブリスニング": "A",
    "理解度": "S",
    "コメント": "...",
    "評価日時": "2025-12-22T05:28:47.579Z"
  },
  "youtube": {
    "overallGrade": "B",
    "subscriberCount": 875,
    "weeklyStreamCount": 7.2,
    "averageStreamDuration": 236,
    ...
  },
  "x": {
    "overallGrade": "D",
    "followersCount": 2638,
    "dailyTweetCount": 3.2,
    ...
  }
}
```

---

**作成日**: 2026-01-03  
**バージョン**: 2.0.0
