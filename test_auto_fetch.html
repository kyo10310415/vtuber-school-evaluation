<!DOCTYPE html>
<html>
<head>
    <title>Auto Fetch Test</title>
    <meta charset="utf-8">
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
        }
        button {
            padding: 20px 40px;
            font-size: 18px;
            cursor: pointer;
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
        }
        button:hover {
            background: #45a049;
        }
        #status {
            margin-top: 20px;
            padding: 20px;
            border: 1px solid #ccc;
            border-radius: 5px;
            font-size: 16px;
        }
        #result {
            margin-top: 20px;
            padding: 20px;
            background: #f5f5f5;
            border-radius: 5px;
            overflow: auto;
            max-height: 500px;
        }
    </style>
</head>
<body>
    <h1>é€±æ¬¡ã‚¢ãƒŠãƒªãƒ†ã‚£ã‚¯ã‚¹ æ‰‹å‹•å®Ÿè¡Œãƒ†ã‚¹ãƒˆ</h1>
    <p>ã“ã®ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨ã€é€±æ¬¡ã‚¢ãƒŠãƒªãƒ†ã‚£ã‚¯ã‚¹ã®ãƒ‡ãƒ¼ã‚¿å–å¾—ã¨ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆæ›¸ãè¾¼ã¿ãŒå®Ÿè¡Œã•ã‚Œã¾ã™ã€‚</p>
    <button onclick="runAutoFetch()">ğŸš€ å®Ÿè¡Œã™ã‚‹</button>
    
    <div id="status"></div>
    <pre id="result"></pre>

    <script>
        async function runAutoFetch() {
            const statusDiv = document.getElementById('status');
            const resultDiv = document.getElementById('result');
            
            statusDiv.innerHTML = 'â³ å®Ÿè¡Œä¸­... (æœ€å¤§5åˆ†ã‹ã‹ã‚‹å ´åˆãŒã‚ã‚Šã¾ã™)<br>Renderã®ãƒ­ã‚°ç”»é¢ã‚’é–‹ã„ã¦ã€ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§ãƒ­ã‚°ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚';
            statusDiv.style.background = '#fff3cd';
            statusDiv.style.color = '#856404';
            resultDiv.innerHTML = '';
            
            const startTime = Date.now();
            
            try {
                const response = await fetch('https://vtuber-school-evaluation.onrender.com/api/analytics/auto-fetch', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });
                
                const data = await response.json();
                const duration = ((Date.now() - startTime) / 1000).toFixed(2);
                
                statusDiv.innerHTML = `âœ… å®Œäº†ï¼ (å®Ÿè¡Œæ™‚é–“: ${duration}ç§’)`;
                statusDiv.style.background = '#d4edda';
                statusDiv.style.color = '#155724';
                resultDiv.innerHTML = JSON.stringify(data, null, 2);
                
                console.log('çµæœ:', data);
                
                // çµæœã®è¦ç´„ã‚’è¡¨ç¤º
                if (data.success) {
                    const summary = `
æˆåŠŸ: ${data.summary.success}äºº
ã‚¨ãƒ©ãƒ¼: ${data.summary.errors}äºº
æœŸé–“: ${data.period.startDate} ã€œ ${data.period.endDate}
                    `;
                    alert('å®Ÿè¡Œå®Œäº†ï¼\n\n' + summary + '\n\nè©³ç´°ã¯ä¸‹ã®JSONã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚');
                }
            } catch (error) {
                const duration = ((Date.now() - startTime) / 1000).toFixed(2);
                statusDiv.innerHTML = `âŒ ã‚¨ãƒ©ãƒ¼: ${error.message} (å®Ÿè¡Œæ™‚é–“: ${duration}ç§’)`;
                statusDiv.style.background = '#f8d7da';
                statusDiv.style.color = '#721c24';
                resultDiv.innerHTML = error.stack || error.message;
            }
        }
    </script>
    
    <hr style="margin-top: 40px;">
    <h2>å®Ÿè¡Œå¾Œã®ç¢ºèªäº‹é …</h2>
    <ol>
        <li><strong>Renderã®ãƒ­ã‚°ã‚’ç¢ºèª</strong>
            <ul>
                <li>ãƒ­ã‚°ã« <code>[Auto Fetch] Starting weekly analytics collection...</code> ãŒè¡¨ç¤ºã•ã‚Œã‚‹</li>
                <li>ãƒ­ã‚°ã« <code>[Auto Fetch] Spreadsheet updated: X students</code> ãŒè¡¨ç¤ºã•ã‚Œã‚‹</li>
            </ul>
        </li>
        <li><strong>ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã‚’ç¢ºèª</strong>
            <ul>
                <li>URL: <a href="https://docs.google.com/spreadsheets/d/1NSW_SSWDHYBQJsDYV7D6ngLThqPzhiWg9gxPoF9zN-k/edit" target="_blank">ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã‚’é–‹ã</a></li>
                <li>ã€Œæ‰€å±ç”Ÿä¸€è¦§ã€ã‚·ãƒ¼ãƒˆãŒä½œæˆã•ã‚Œã¦ã„ã‚‹</li>
                <li>å„ç”Ÿå¾’ã®å€‹äººãƒ‡ãƒ¼ã‚¿ã‚·ãƒ¼ãƒˆãŒä½œæˆã•ã‚Œã¦ã„ã‚‹</li>
            </ul>
        </li>
    </ol>
</body>
</html>
