# トークメモフォルダURL自動入力セットアップガイド

## 📋 概要

このスクリプトは、Google Driveの親フォルダ内にある学籍番号のフォルダを自動検索し、スプレッドシートのE列にフォルダURLを自動入力します。

## 🎯 対象

- **スプレッドシート**: https://docs.google.com/spreadsheets/d/1MHRtvgDb-AWm7iBz9ova7KknwCrbcykp15ZtAlkbq-M/edit
- **親フォルダ**: https://drive.google.com/drive/folders/18YfaP1CrW5Lq_sAeVAR56tIRZR3GwMDS

## 🔧 セットアップ手順

### 1. Google Apps Scriptを開く

1. スプレッドシートを開く
2. メニューバーから `拡張機能` → `Apps Script` を選択
3. 新しいタブでApps Scriptエディタが開く

### 2. スクリプトを追加

1. 左側の「ファイル」セクションで `+` ボタンをクリック
2. 「スクリプト」を選択
3. ファイル名を `AutoFillTalkMemoUrls` に変更
4. `/home/user/webapp/gas/AutoFillTalkMemoUrls.gs` の内容をコピー＆ペースト

### 3. 権限を承認

1. エディタ上部の「実行」ボタン（▶）をクリック
2. 「権限を確認」をクリック
3. Googleアカウントを選択
4. 「詳細」→「（プロジェクト名）に移動」をクリック
5. 「許可」をクリック

必要な権限:
- Google Driveへのアクセス
- Google Sheetsへのアクセス

### 4. スクリプトを保存

1. `Ctrl + S` (Mac: `Cmd + S`) で保存
2. エディタを閉じる

## 🚀 使い方

### メニューから実行

スプレッドシートを開くと、メニューバーに「🔧 自動化ツール」が追加されます：

1. **📁 トークメモフォルダURL自動入力**
   - 学籍番号に対応するフォルダURLを自動的にE列に入力
   - 既存のURLは上書きされます
   - 実行前に確認ダイアログが表示されます

2. **✅ 全URLを検証**
   - 既存のURLが正しいか検証
   - フォルダ名と学籍番号の一致を確認
   - 無効なURLを一覧表示

### 実行結果

```
完了しました！

更新: 25件
未検出: 3件

未検出の学籍番号:
OLTS999999-XX, OLTS888888-YY, OLTS777777-ZZ
```

## 📝 仕様

### フォルダ検索ルール

- 親フォルダ: `18YfaP1CrW5Lq_sAeVAR56tIRZR3GwMDS`
- フォルダ名 = 学籍番号（完全一致）
- 例: `OLTS240488-AR` というフォルダを検索

### スプレッドシート構造

| 列 | 項目 | 説明 |
|---|---|---|
| A列 | 学籍番号 | 例: OLTS240488-AR |
| E列 | トークメモフォルダURL | 自動入力される |

### URL形式

```
https://drive.google.com/drive/folders/FOLDER_ID
```

## 🔍 トラブルシューティング

### ❌ 「フォルダが見つかりません」

**原因**:
- フォルダ名が学籍番号と完全一致していない
- フォルダが親フォルダ内にない

**解決策**:
1. Google Driveで親フォルダを確認
2. フォルダ名が学籍番号と完全一致しているか確認（大文字小文字、ハイフンなど）
3. フォルダが正しい場所にあるか確認

### ❌ 「権限がありません」エラー

**原因**:
- スクリプトがGoogle Driveへのアクセス権限を持っていない

**解決策**:
1. Apps Scriptエディタで「実行」をクリック
2. 権限の承認を再実行
3. 「Google Driveへのアクセス」を許可

### ❌ 「シートが見つかりません」

**原因**:
- シート名が「生徒マスター」になっていない

**解決策**:
1. スプレッドシートでシート名を確認
2. `AutoFillTalkMemoUrls.gs` の `CONFIG.SHEET_NAME` を修正

## 🧪 テスト方法

### 1. テスト実行（確認用）

Apps Scriptエディタで `testAutoFill` 関数を実行：

```javascript
function testAutoFill() {
  // 親フォルダ内のすべてのサブフォルダを一覧表示
}
```

**実行方法**:
1. エディタで `testAutoFill` 関数を選択
2. 「実行」ボタンをクリック
3. 「ログ」を開いてフォルダ一覧を確認

### 2. 少数の行でテスト

1. スプレッドシートで一部の行のE列を空にする
2. 「トークメモフォルダURL自動入力」を実行
3. 結果を確認

### 3. 全体実行

1. すべての行でテスト
2. 「全URLを検証」で正常性を確認

## 📊 動作フロー

```
[実行開始]
    ↓
[親フォルダからサブフォルダを取得]
    ↓
[フォルダ名（学籍番号）でマッピング作成]
    ↓
[スプレッドシートの各行を処理]
    ↓
    ├─ 学籍番号を取得
    ├─ 対応するフォルダURLを検索
    └─ E列にURLを入力
    ↓
[結果を表示]
```

## 🔄 定期実行（オプション）

### トリガー設定（月次自動実行）

新しい生徒が追加された時に自動実行したい場合：

1. Apps Scriptエディタで「トリガー」（時計アイコン）をクリック
2. 「トリガーを追加」をクリック
3. 以下を設定：
   - 実行する関数: `autoFillTalkMemoUrls`
   - イベントのソース: `時間主導型`
   - 時間ベースのトリガー: `月タイマー`
   - 日時: `1日` `午前3時～4時`
4. 「保存」をクリック

**注意**: 自動実行の場合、確認ダイアログは表示されません。

## 📚 関連ファイル

- `/home/user/webapp/gas/AutoFillTalkMemoUrls.gs` - メインスクリプト
- `/home/user/webapp/gas/AUTOMATION_SETUP.md` - 月次評価自動化ガイド
- `/home/user/webapp/gas/MonthlyEvaluationAutomation.gs` - 月次評価スクリプト

## 🤝 サポート

問題が発生した場合：
1. Apps Scriptエディタの「ログ」を確認
2. エラーメッセージをコピー
3. 開発者に連絡

---

**作成日**: 2025-12-29  
**バージョン**: 1.0.0
